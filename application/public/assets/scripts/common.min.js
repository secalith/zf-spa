/*! secalith-spa lib - v1.0.0 -2018-03-27 */
class Chat{constructor(e){this.callbackName=e,this.plugins={},this.plugins.html=new Html,this.plugins.chatWindow=new ChatWindow(this.callbackName),this.plugins.chatAjax=new ChatAjax(this.callbackName),window[this.callbackName]=this,this.init()}init(){document.querySelector(this.plugins.chatWindow.chatSubmitBtn).setAttribute("onClick","javascript:"+this.callbackName+".submitMessage();"),this.plugins.chatAjax.connect().then(function(e){var t={tag:"div",children:[{tag:"i",text:e.message}]},a=window.chat.plugins.html.createHtmlFromJSON(t);document.querySelector(window.chat.plugins.chatWindow.chatHistory).appendChild(a)}),this.setTimer()}getIdentity(){return this.userIdentity}setIdentity(e){return this.userIdentity=e,this}readMessages(){var e=this.plugins.chatAjax.readNew();console.log(e)}setTimer(){setInterval(window[this.callbackName].readMessages,1e3)}submitMessage(){var e=document.querySelector(this.plugins.chatWindow.chatText).value;if(0==e.length)return!1;var t=document.createElement("div"),a=document.createTextNode(e);t.appendChild(a),document.querySelector(this.plugins.chatWindow.chatHistory).appendChild(t),this.plugins.chatAjax.create({identity:this.getIdentity(),message:e}),document.querySelector(this.plugins.chatWindow.chatText).value="",console.log(e)}}class ChatWindow{constructor(e){this.callbackName=e,this.chatWrapper="#chat-wrapper",this.chatText="#chat-text",this.chatHistory="#chat-history",this.chatSubmitBtn="#chat-submit-btn"}}class ChatAjax{constructor(e){this.callbackName=e,this.server={},this.server.url={},this.server.url.status="/messenger/chat/status",this.server.url.create="/messenger/chat/create",this.server.url.read="/messenger/chat/read"}connect(){return this.get(this.server.url.status)}readNew(){return this.get(this.server.url.read)}create(e){this.postData(this.server.url.create,e).then(e=>console.log(e)).catch(e=>console.error(e))}get(e){return fetch(e).then(window[this.callbackName].ajaxStatus).then(function(e){return e.json()}).then(function(e){return e}).catch(function(e){console.log("Request failed",e)})}ajaxStatus(e){return e.status>=200&&e.status<300?Promise.resolve(e):Promise.reject(new Error(e.statusText))}postData(e,t){return fetch(e,{body:JSON.stringify(t),cache:"no-cache",credentials:"same-origin",headers:{"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json"},method:"POST",mode:"cors",redirect:"follow",referrer:"no-referrer"}).then(e=>e.json())}}class Html{openTagString(e,t){return"<"+e+">"}closeTagString(e){return"</"+e+">"}createTag(e){}createHtmlFromJSON(e){var t="";if(void 0===e)return"error";if(void 0!==e.tag&&(t=document.createElement(e.tag),void 0!==e.children))for(var a in e.children){var r=document.createElement(e.children[a].tag);void 0!==e.children[a].text&&r.appendChild(document.createTextNode(e.children[a].text)),t.appendChild(r)}return t}toogleClass(e,t){var a=e.className,r=new RegExp("\\b"+t+"\\b"),s=a.match(r);t=t.replace(/\s+/g,""),e.className=s?a.replace(r,""):a+t}}const Timeout=(()=>{const e={},t={},a=a=>{clearTimeout(e[a]),delete e[a],delete t[a]},r=t=>t in e,s=e=>e in t&&t[e];return{set:(...r)=>{let i,n,c;3==r.length?[i,n,c]=r:([n,c]=r,i=n),a(i);return e[i]=setTimeout(()=>(t[i]=!0,n()),c),t[i]=!1,()=>s(i)},clear:a,exists:r,pending:e=>r(e)&&!s(e),executed:s}})();