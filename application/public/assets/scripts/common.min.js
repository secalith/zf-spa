/*! secalith-spa lib - v1.0.0 -2018-03-28 */
class Chat{constructor(t){this.callbackName=t,this.plugins={},this.plugins.html=new Html,this.plugins.chatWindow=new ChatWindow(this.callbackName),this.plugins.chatAjax=new ChatAjax(this.callbackName),this.userIdentity=null,window[this.callbackName]=this,this.init()}init(){document.querySelector(this.plugins.chatWindow.chatSubmitBtn).setAttribute("onClick","javascript:"+this.callbackName+".submitMessage();return false;"),document.querySelector(this.plugins.chatWindow.btnMinimize).setAttribute("onClick","javascript:"+this.callbackName+".minimize();return false;"),document.querySelector(this.plugins.chatWindow.btnMaximize).setAttribute("onClick","javascript:"+this.callbackName+".maximize();return false;"),this.connect().then(function(t){var e={tag:"div",children:[{tag:"span",text:"server: "},{tag:"i",text:t.message}]},i=window.chat.plugins.html.createHtmlFromJSON(e);document.querySelector(window.chat.plugins.chatWindow.chatContent).appendChild(i),window.chat.plugins.chatWindow.toggleIconRefresh().setKeyEnterSubmitObserver()}),this.setTimer()}minimize(){return this.plugins.chatWindow.chatMinimize()}maximize(){return this.plugins.chatWindow.chatMaximize()}connect(){return this.plugins.chatAjax.connect()}getIdentity(){return this.userIdentity}setIdentity(t){return this.userIdentity=t,this}readMessages(){window.chat.plugins.chatWindow.toggleIconRefresh();window.chat.plugins.chatAjax.readNew();window.chat.plugins.chatWindow.toggleIconRefresh()}setTimer(){setInterval(window[this.callbackName].readMessages,5e3)}submitMessage(){window[this.callbackName].plugins.chatWindow.toggleIconRefresh();var t=document.querySelector(this.plugins.chatWindow.chatText).value;if(0==t.length)return!1;var e={tag:"div",children:[{tag:"span",text:"you: "},{tag:"span",text:t}]},i=window.chat.plugins.html.createHtmlFromJSON(e);document.querySelector(window.chat.plugins.chatWindow.chatContent).appendChild(i),this.plugins.chatAjax.create({identity:this.getIdentity(),message:t}),document.querySelector(this.plugins.chatWindow.chatText).value="",console.log(t),window[this.callbackName].plugins.chatWindow.toggleIconRefresh()}}class ChatWindow{constructor(t){this.callbackName=t,this.chatWrapper="#chat-wrapper",this.chatWrapperStatusMinimized=".chat-display-minimized",this.chatText="#chat-text",this.chatBody="#chat-body",this.chatContent="#chat-content",this.chatSubmitBtn="#chat-submit-btn",this.chatIconRefresh=".glyphicon-refresh",this.btnMinimize=".chat-tab-minimize",this.btnMaximize=".chat-tab-maximize",this.optEnterSend="#chat-option-enter_send"}setKeyEnterSubmitObserver(){document.querySelector(this.chatText).onkeypress=function(t){if(t||(t=window.event),"13"==(t.keyCode||t.which))return!0===window.chat.plugins.html.isChecked(window.chat.plugins.chatWindow.optEnterSend)&&window.chat.submitMessage(),!1}}chatMaximize(){return this.chatMinimize()}chatMinimize(){window.chat.plugins.html.toggleClass(document.querySelector(window.chat.plugins.chatWindow.chatWrapper),this.chatWrapperStatusMinimized)}toggleIconRefresh(){var t=document.querySelector(window[this.callbackName].plugins.chatWindow.chatIconRefresh);return window.chat.plugins.html.toggleClass(t,"hidden"),this}}class ChatAjax{constructor(t){this.callbackName=t,this.server={},this.server.url={},this.server.url.status="/messenger/chat/status",this.server.url.create="/messenger/chat/create",this.server.url.read="/messenger/chat/read",this.server.url.read="/messenger/chat/status"}connect(){return this.get(this.server.url.status)}readNew(){return this.get(this.server.url.read)}create(t){this.postData(this.server.url.create,t).then(t=>console.log(t)).catch(t=>console.error(t))}get(t){return fetch(t).then(window[this.callbackName].ajaxStatus).then(function(t){return t.json()}).then(function(t){return t}).catch(function(t){console.log("Request failed",t)})}ajaxStatus(t){return t.status>=200&&t.status<300?Promise.resolve(t):Promise.reject(new Error(t.statusText))}postData(t,e){return fetch(t,{body:JSON.stringify(e),cache:"no-cache",credentials:"same-origin",headers:{"user-agent":"Mozilla/4.0 MDN Example","content-type":"application/json"},method:"POST",mode:"cors",redirect:"follow",referrer:"no-referrer"}).then(t=>t.json())}}class Html{openTagString(t,e){return"<"+t+">"}closeTagString(t){return"</"+t+">"}createTag(t){}createHtmlFromJSON(t){var e="";if(void 0===t)return"error";if(void 0!==t.tag&&(e=document.createElement(t.tag),void 0!==t.children))for(var i in t.children){var a=document.createElement(t.children[i].tag);void 0!==t.children[i].text&&a.appendChild(document.createTextNode(t.children[i].text)),e.appendChild(a)}return e}isChecked(t){return document.querySelector(t).checked}cleanSelector(t){for(;"."===t.charAt(0)||"#"===t.charAt(0);)t=t.substr(1);return t}toggleClass(t,e){e=this.cleanSelector(e);var i=t.className,a=new RegExp("\\b"+e+"\\b"),n=i.match(a);e=e.replace(/\s+/g,""),t.className=n?i.replace(a,""):i+" "+e}}const Timeout=(()=>{const t={},e={},i=i=>{clearTimeout(t[i]),delete t[i],delete e[i]},a=e=>e in t,n=t=>t in e&&e[t];return{set:(...a)=>{let r,s,c;3==a.length?[r,s,c]=a:([s,c]=a,r=s),i(r);return t[r]=setTimeout(()=>(e[r]=!0,s()),c),e[r]=!1,()=>n(r)},clear:i,exists:a,pending:t=>a(t)&&!n(t),executed:n}})();